From a5e3d0f593604d9c91566c845377567f7c39b39f Mon Sep 17 00:00:00 2001
From: Silime <1776303288@qq.com>
Date: Wed, 24 Aug 2022 09:34:08 +0800
Subject: [PATCH] add nfc support

---
 .../boot/dts/qcom/sdm845-oneplus-common.dtsi  | 30 +++++++++++++++++++
 arch/arm64/configs/sdm845.config              |  2 ++
 2 files changed, 32 insertions(+)

diff --git a/arch/arm64/boot/dts/qcom/sdm845-oneplus-common.dtsi b/arch/arm64/boot/dts/qcom/sdm845-oneplus-common.dtsi
index badc526e7..eadeb6596 100644
--- a/arch/arm64/boot/dts/qcom/sdm845-oneplus-common.dtsi
+++ b/arch/arm64/boot/dts/qcom/sdm845-oneplus-common.dtsi
@@ -419,6 +419,23 @@ zap-shader {
 	};
 };
 
+&i2c3 {
+	status = "okay";
+	nfc@28 {
+		compatible = "nxp,nxp-nci-i2c";
+		reg = <0x28>;
+
+		interrupt-parent = <&tlmm>;
+		interrupts = <63 IRQ_TYPE_LEVEL_HIGH>;
+
+		enable-gpios = <&tlmm 129 GPIO_ACTIVE_HIGH>;
+
+		pinctrl-names = "default";
+		pinctrl-0 = <&nfc_int_active &nfc_enable_active>;
+	};
+
+};
+
 &i2c10 {
 	status = "okay";
 	clock-frequency = <100000>;
@@ -839,6 +856,19 @@ mux {
 			input-enable;
 		};
 	};
+	nfc_int_active: nfc_int_active {
+		pins = "gpio63";
+		function = "gpio";
+		drive-strength = <6>;
+		bias-pull-up;
+	};
+
+	nfc_enable_active: nfc_enable_active {
+		pins = "gpio12", "gpio129";
+		function = "gpio";
+		drive-strength = <6>;
+		bias-pull-up;
+	};
 };
 
 &venus {
diff --git a/arch/arm64/configs/sdm845.config b/arch/arm64/configs/sdm845.config
index 36f2ac836..facc79ba4 100644
--- a/arch/arm64/configs/sdm845.config
+++ b/arch/arm64/configs/sdm845.config
@@ -8,6 +8,8 @@ CONFIG_HID_RMI=m
 CONFIG_RMI4_CORE=m
 CONFIG_RMI4_I2C=m
 CONFIG_RMI4_F55=y
+CONFIG_NFC_NXP_NCI=m
+CONFIG_NFC_NXP_NCI_I2C=m
 
 # OnePlus 6T
 CONFIG_SND_SOC_TFA98XX=m
-- 
2.34.1
